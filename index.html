<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Budget Tracker</title>
    <style>
        .dark-mode {
    background-color: #333;
    color: white;
}

        body { font-family: Arial, sans-serif; text-align: center; padding: 20px; }
        #login-form, #transaction-form, #transactions { max-width: 400px; margin: auto; }
        input, button { display: block; width: 100%; margin-top: 10px; padding: 10px; }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; background-color: #f4f4f4; padding: 20px; }
        input, button, select { width: 100%; padding: 10px; margin: 10px 0; border: 1px solid #ccc; border-radius: 5px; }
        button { background-color: #28a745; color: white; cursor: pointer; }
        button:hover { background-color: #218838; }
        table { width: 80%; margin: auto; border-collapse: collapse; background: white; }
        th, td { padding: 10px; border: 1px solid #ddd; text-align: center; }
        th { background: #007bff; color: white; }
        canvas { max-width: 400px; margin: 20px auto; }
    </style>
    
</head>
<body>
    <h1>Budget Tracker</h1>
    
    <div id="login-form">
        <h2>Login</h2>
        <input type="text" id="username" placeholder="Username">
        <input type="password" id="password" placeholder="Password">
        <button onclick="login()">Login</button>
    </div>

    <div id="transaction-form" style="display:none;">
        <h2>Add Transaction</h2>
        <input type="number" id="amount" placeholder="Amount">
        <input type="text" id="category" placeholder="Category">
        <select id="type">
            <option value="income">Income</option>
            <option value="expense">Expense</option>
        </select>
        <button onclick="addTransaction()">Add Transaction</button>
    </div>

    <div id="transactions" style="display:none;">
        <h2>Transactions</h2>
        <table border="1">
            <tr>
              <th>Type</th>
              <th>Category</th>
              <th>Amount</th>
              <th>Date</th>
            </tr>
            <tbody id="transaction-list"></tbody>
          </table>
          
    </div>
    <button onclick="toggleDarkMode()">Toggle Dark Mode</button>

    <script>
        let token = "";

        function login() {
            const username = document.getElementById("username").value;
            const password = document.getElementById("password").value;
            
            fetch("https://app.py.onrender.com/login", {  // ✅ Uses live backend
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ username, password })
            })
            .then(response => response.json())
            .then(data => {
                if (data.access_token) {
                    token = data.access_token;
                    document.getElementById("login-form").style.display = "none";
                    document.getElementById("transaction-form").style.display = "block";
                    document.getElementById("transactions").style.display = "block";
                    getTransactions();
                } else {
                    alert("Login failed");
                }
            });
        }

        function addTransaction() {
            const amount = document.getElementById("amount").value;
            const category = document.getElementById("category").value;
            const type = document.getElementById("type").value;
            
            fetch("https://app.py.onrender.com/transactions", {
                method: "POST",
                headers: { 
                    "Content-Type": "application/json",
                    "Authorization": `Bearer ${token}`
                },
                body: JSON.stringify({ amount, category, type })
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
                getTransactions();
            });
        }

        let budgetChart;

        function getTransactions() {
    fetch("https://app.py.onrender.com/transactions", {
        headers: { "Authorization": `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        const tableBody = document.getElementById("transaction-list");
        tableBody.innerHTML = ""; 

        let totalIncome = 0;
        let totalExpense = 0;

        const filterMonth = document.getElementById("filter-month").value;

        const filteredData = data.filter(t => {
            const transactionDate = new Date(t.date);
            const selectedMonth = new Date(filterMonth + "-01");

            return !filterMonth || 
                   (transactionDate.getFullYear() === selectedMonth.getFullYear() &&
                   transactionDate.getMonth() === selectedMonth.getMonth());
        });

        filteredData.forEach(t => {
            const row = document.createElement("tr");
            row.innerHTML = `
                <td>${t.type.toUpperCase()}</td>
                <td>${t.category}</td>
                <td>$${t.amount}</td>
                <td>${t.date}</td>
            `;
            tableBody.appendChild(row);

            if (t.type === "income") {
                totalIncome += t.amount;
            } else {
                totalExpense += t.amount;
            }
        });

        document.getElementById("total-income").textContent = `$${totalIncome}`;
        document.getElementById("total-expense").textContent = `$${totalExpense}`;
        document.getElementById("balance").textContent = `$${totalIncome - totalExpense}`;
    });
}



        function logout() {
    token = "";  // Clear token
    location.reload();  // Refresh the page
        }

        function toggleDarkMode() {
    document.body.classList.toggle('dark-mode');
}
let budgetLimit = 0;

function checkBudget() {
    budgetLimit = document.getElementById("budget-limit").value;
    alert("Budget limit set!");
}

function getTransactions() {
    fetch("https://app.py.onrender.com/transactions", {
        headers: { "Authorization": `Bearer ${token}` }
    })
    .then(response => response.json())
    .then(data => {
        let totalExpense = 0;

        data.forEach(t => {
            if (t.type === "expense") {
                totalExpense += t.amount;
            }
        });

        document.getElementById("total-expense").textContent = `$${totalExpense}`;
        
        if (budgetLimit > 0 && totalExpense > budgetLimit) {
            document.getElementById("budget-warning").textContent = 
                "⚠ Warning: You have exceeded your monthly budget!";
        } else {
            document.getElementById("budget-warning").textContent = "";
        }
    });
}

    </script>
   
    
    <button onclick="logout()">Logout</button>
    <h2>Budget Summary</h2>
    <p>Total Income: <span id="total-income">$0</span></p>
    <p>Total Expenses: <span id="total-expense">$0</span></p>
    <p>Balance: <span id="balance">$0</span></p>
    <h2>Budget Overview</h2>
<canvas id="budgetChart" width="400" height="200"></canvas>
<button onclick="exportToCSV()">Download Transactions (CSV)</button>
<select id="filter-type" onchange="getTransactions()">
    <option value="">All</option>
    <option value="income">Income</option>
    <option value="expense">Expense</option>
</select>

<select id="filter-category" onchange="getTransactions()">
    <option value="">All Categories</option>
    <option value="Food">Food</option>
    <option value="Shopping">Shopping</option>
    <option value="Salary">Salary</option>
</select>
<input type="month" id="filter-month" onchange="getTransactions()">
<input type="number" id="budget-limit" placeholder="Set Monthly Budget">
<button onclick="checkBudget()">Set Budget</button>
<p id="budget-warning" style="color: red;"></p>

</body>
</html>
